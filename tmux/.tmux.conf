# Note to self:
# bind == bind-key
# unbind == unbind-key
# bind-key assumes CTRL combo unless stroke added to global namespace

# This is what TERM will be inside the tmux session
set-option -g default-terminal "tmux-256color"
# This tells tmux to enable full colors if TERM outside is xterm-256color
#set-option -g terminal-overrides ",xterm-256color:RGB"
set-option -ga terminal-overrides ',xterm-256color:Tc'

# Rebind prefix/leader key
unbind C-b
set -g prefix C-space

# Mouse can be used to select panes, select windows (by clicking on the status
# bar), resize panes. For default bindings see `tmux list-keys`
set -g mouse on

set -s set-clipboard on

# History memory increased per pane
set-option -g history-limit 10000

# - #S = session name
# - #T = pane title (~/.zshrc sets this to the last/current command)
set-option -g set-titles-string "#S > #T"

# Turn off distracting border highlight.
set-option -ga pane-active-border-style bg=default,fg=default

# Highlight active window.
set-option -w -g window-status-current-style bg=red

set -g status-keys vi
set-window-option -g mode-keys vi

# press PREFIX/LEADER-r to reload config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "Reloaded ~/.tmux.conf"

# Add vim bindings for pane nav
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

bind -n C-x kill-pane


#### COLOUR (Solarized dark)

# default statusbar colors
set-option -g status-style fg=yellow,bg=black #yellow and base02

# default window title colors
set-window-option -g window-status-style fg=brightblue,bg=default #base0 and default
#set-window-option -g window-status-style dim

# active window title colors
set-window-option -g window-status-current-style fg=brightred,bg=default #orange and default
#set-window-option -g window-status-current-style bright

# pane border
set-option -g pane-border-style fg=black #base02
set-option -g pane-active-border-style fg=brightgreen #base01

# message text
set-option -g message-style fg=brightred,bg=black #orange and base01

# pane number display
set-option -g display-panes-active-colour brightred #orange
set-option -g display-panes-colour blue #blue

# clock
set-window-option -g clock-mode-colour green #green

# bell
set-window-option -g window-status-bell-style fg=black,bg=red #base02, red


is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
# Either send appropriate keystrokes for vim or tmux depending on whether vim is running in pane
bind-key -n C-h  if-shell  "$is_vim"  "send-keys C-h"  "select-pane -L"
bind-key -n C-j   if-shell  "$is_vim"  "send-keys C-j"   "select-pane -D"
bind-key -n C-k  if-shell  "$is_vim"  "send-keys C-k"  "select-pane -U"
bind-key -n C-l   if-shell  "$is_vim"  "send-keys C-l"   "select-pane -R"
bind-key -n C-\   if-shell  "$is_vim"  "send-keys C-\\"  "select-pane -l"

# keys bound in a key table: see tmux list-keys
# default namespace: prefix key table
# -n == -T "root"
# -r means key can be repeated within interval repeat-time

bind-key -r '+' resize-pane -U 10  
bind-key -r '-' resize-pane -D 10  
bind-key -r '<' resize-pane -L 10  
bind-key -r '>' resize-pane -R 10

# v and h are not bound by default, but we never know in the next versions...
unbind-key -T root v
unbind-key -T root h
unbind % # Split vertically
unbind '"' # Split horizontally
# rename illogical, and run cmd to make path as starting point
bind v split-window -h -c "#{pane_current_path}"
bind h split-window -v -c "#{pane_current_path}"
bind -T root S-left prev
bind -T root S-right next
bind-key -T root S-down new-window

# It is better to bypass tmux copy-paste stuff and hold SHIFT while selecting with mouse
# But this is how to instruct tmux to copy and paste to the system clipboard
# Double LMB Select & Copy (Word)
bind-key -T copy-mode DoubleClick1Pane \
    select-pane \; \
    send-keys -X select-word-no-clear \; \
    send-keys -X copy-pipe-no-clear "xclip -in -sel primary"
bind-key -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-word-no-clear \; \
    send-keys -X copy-pipe-no-clear "xclip -in -sel primary"

set-option -g word-separators "-,./?%&#_~"

# pane movement
bind-key j command-prompt -p "join pane from:"  "join-pane -s '%%'"
bind-key s command-prompt -p "send pane to:"  "join-pane -t '%%'"
bind-key b "break-pane"
